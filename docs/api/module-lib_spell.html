<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>lib/spell - Documentation</title>
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Bone.html">Bone</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#.attribute">attribute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#.belongsTo">belongsTo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#.create">create</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#.describe">describe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#.find">find</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#.findOne">findOne</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#.hasMany">hasMany</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#.hasOne">hasOne</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#.include">include</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#.reflectClass">reflectClass</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#.reflectType">reflectType</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#.remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#.renameAttribute">renameAttribute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#.update">update</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#attribute">attribute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#attributeChanged">attributeChanged</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#attributeWas">attributeWas</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#inspect">inspect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#save">save</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#toJSON">toJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Bone.html#toObject">toObject</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Collection.html">Collection</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Collection.html#save">save</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Collection.html#toJSON">toJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Collection.html#toObject">toObject</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Spell.html">Spell</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#$delete">$delete</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#$from">$from</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#$get">$get</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#$group">$group</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#$having">$having</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#$join">$join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#$limit">$limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#$offset">$offset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#$order">$order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#$select">$select</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#$where">$where</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#$with">$with</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#batch">batch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#catch">catch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#then">then</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#toSqlString">toSqlString</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Spell.html#toString">toString</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-index.html">index</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-index.html#.connect">connect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-index.html#~schemaInfo">schemaInfo</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-lib_bone.html">lib/bone</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_bone.html#~camelCase">camelCase</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_bone.html#~capitalize">capitalize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_bone.html#~snakeCase">snakeCase</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_bone.html#~uncapitalize">uncapitalize</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-lib_expr.html">lib/expr</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_expr.html#~isEqualOrHigher">isEqualOrHigher</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_expr.html#~parseExpr">parseExpr</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_expr.html#~parseExprList">parseExprList</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-lib_spell.html">lib/spell</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~copyExpr">copyExpr</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~findModel">findModel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~findRelation">findRelation</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~formatColumn">formatColumn</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~formatConditions">formatConditions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~formatDelete">formatDelete</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~formatExpr">formatExpr</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~formatIdentifier">formatIdentifier</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~formatInsert">formatInsert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~formatOpExpr">formatOpExpr</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~formatOrders">formatOrders</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~formatSelect">formatSelect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~formatSelectWithJoin">formatSelectWithJoin</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~formatSelectWithoutJoin">formatSelectWithoutJoin</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~formatUpdate">formatUpdate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~formatUpsert">formatUpsert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~isAggregator">isAggregator</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~isLogicalOp">isLogicalOp</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~joinOnConditions">joinOnConditions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~joinRelation">joinRelation</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~parseConditions">parseConditions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~parseObjectConditions">parseObjectConditions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~parseObjectValue">parseObjectValue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~parseSet">parseSet</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~Spell_deletedAtIsNull">Spell_deletedAtIsNull</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-lib_spell.html#~walkExpr">walkExpr</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">lib/spell</h1>
    

    




<section>

<header>
    
        
            
        
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description"><p>This module consist of two major parts, helper functions like <a href="module-lib_spell.html#~formatSelect"><code>module:lib/spell~formatSelect</code></a>, and the <a href="Spell.html"><code>Spell</code></a> class. The helper functions are left out as inner functions to keep Spell prototype clean. Most of the helper functions deal with the AST parsed by <a href="module-lib_expr.html"><code>module:lib/expr</code></a>.</p></div>
        

        
            
<div class="section-method">







<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>























</div>

        
    
    </div>

    

    

    

     

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            
<div class="section-method">

    

    <h4 class="name" id="~copyExpr"><span class="type-signature">(inner) </span>copyExpr<span class="signature">(ast, fn)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Walk through an ast with returned tokens preferred over the originals, which is convenient to update the ast.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>ast</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>fn</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>function</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















<div class="section-examples">
<h5>Example:</h5>

    <pre class="prettyprint"><code>// update all of the identifiers' qualifiers:
copyExpr(ast, ({ type, value }) => {
  if (type == 'id') return { type, qualifiers: ['posts'], value }
})</code></pre>

</div>

</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~findModel"><span class="type-signature">(inner) </span>findModel<span class="signature">(spell, qualifiers)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Find model by qualifiers.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>qualifiers</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Array.&lt;string></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















<div class="section-examples">
<h5>Example:</h5>

    <pre class="prettyprint"><code>findModel(spell, ['comments'])
findModel(spell)</code></pre>

</div>

</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~findRelation"><span class="type-signature">(inner) </span>findRelation<span class="signature">(relations, opts)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Find relation by certain criteria.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>relations</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                <p>Model relations</p>
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>opts</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                <p>Search criteria, e.g. { Model }</p>
                
            </td>
        </tr>

    
    </tbody>
</table>
















<div class="section-examples">
<h5>Example:</h5>

    <pre class="prettyprint"><code>findRelation({ Model: Post })</code></pre>

</div>

</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~formatColumn"><span class="type-signature">(inner) </span>formatColumn<span class="signature">(spell, token)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Format token into identifiers/functions/etc. in SQL</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>token</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















<div class="section-examples">
<h5>Example:</h5>

    <pre class="prettyprint"><code>formatColumn(spell, { type: 'id', value: 'title' })
// => `title`

formatColumn(spell, { type: 'func', name: 'year', args: [ { type: 'id', value: 'createdAt' } ] })
// => YEAR(`createdAt`)</code></pre>

</div>

</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~formatConditions"><span class="type-signature">(inner) </span>formatConditions<span class="signature">(conditions)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Format an array of conditions into an expression. Conditions will be joined with <code>AND</code>.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>conditions</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Array.&lt;Object></code></span>


            
            </td>

            

            

            <td class="description last">
                <p>An array of parsed where/having/on conditions</p>
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~formatDelete"><span class="type-signature">(inner) </span>formatDelete<span class="signature">(spell)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Format the spell into a DELETE query.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~formatExpr"><span class="type-signature">(inner) </span>formatExpr<span class="signature">(spell, ast)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Format the abstract syntax tree of an expression into escaped string.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>ast</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~formatIdentifier"><span class="type-signature">(inner) </span>formatIdentifier<span class="signature">(spell, ast)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Format identifiers into escaped string with qualifiers.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>ast</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~formatInsert"><span class="type-signature">(inner) </span>formatInsert<span class="signature">(spell)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Format a spell into INSERT query.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~formatOpExpr"><span class="type-signature">(inner) </span>formatOpExpr<span class="signature">(spell, ast)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Format <code>{ type: 'op' }</code> expressions into escaped string.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>ast</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~formatOrders"><span class="type-signature">(inner) </span>formatOrders<span class="signature">(spell, orders)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Format orders into ORDER BY clause in SQL</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>orders</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Array.&lt;Object></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~formatSelect"><span class="type-signature">(inner) </span>formatSelect<span class="signature">(spell)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>To help choosing the right function when formatting a spell into SELECT query.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~formatSelectWithJoin"><span class="type-signature">(inner) </span>formatSelectWithJoin<span class="signature">(spell)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Format a spell with joins into a full SELECT query.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~formatSelectWithoutJoin"><span class="type-signature">(inner) </span>formatSelectWithoutJoin<span class="signature">(spell)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Format a spell without joins into a full SELECT query. This function is also used to format the subquery which is then used as a drived table in a SELECT with joins.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~formatUpdate"><span class="type-signature">(inner) </span>formatUpdate<span class="signature">(spell)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Format a spell into UPDATE query</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~formatUpsert"><span class="type-signature">(inner) </span>formatUpsert<span class="signature">(spell)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Taking advantage of MySQL's <code>on duplicate key update</code>, though knex does not support this because it has got several databases to be compliant of. PostgreSQL has got proper <code>upsert</code>. Maybe we can file a PR to knex someday.</p>
<p>References:</p>
<ul>
<li>http://dev.mysql.com/doc/refman/5.7/en/insert-on-duplicate.html</li>
<li>https://github.com/tgriesser/knex/issues/701</li>
</ul>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~isAggregator"><span class="type-signature">(inner) </span>isAggregator<span class="signature">(func)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Check if current function is an aggreator such as COUNT/AVG/MIN/MAX/SUM.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>func</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>string</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~isLogicalOp"><span class="type-signature">(inner) </span>isLogicalOp<span class="signature">(ast)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Check if current token is logical operator or not, e.g. <code>AND</code>/<code>NOT</code>/<code>OR</code>.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>ast</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~joinOnConditions"><span class="type-signature">(inner) </span>joinOnConditions<span class="signature">(spell, BaseModel, baseName, refName, opts)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Construct on conditions as ast from associations.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>BaseModel</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Model</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>baseName</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>string</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>refName</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>string</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>opts</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
                    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>relation</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                <p>the relation between BaseModel and RefModel</p>
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>where</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                <p>used to override relation.where when processing <code>{ through }</code> relations</p>
                
            </td>
        </tr>

    
    </tbody>
</table>

                
            </td>
        </tr>

    
    </tbody>
</table>
















<div class="section-examples">
<h5>Example:</h5>

    <pre class="prettyprint"><code>joinOnConditions(spell, Post, 'posts', 'comments', {
    relation: { Model: Comment, foreignKey: 'postId' }
})</code></pre>

</div>

</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~joinRelation"><span class="type-signature">(inner) </span>joinRelation<span class="signature">(spell, BaseModel, baseName, refName, opts)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Parse relations into spell.joins</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                <p>An instance of spell</p>
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>BaseModel</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Model</code></span>


            
            </td>

            

            

            <td class="description last">
                <p>A subclass of Bone</p>
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>baseName</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>string</code></span>


            
            </td>

            

            

            <td class="description last">
                <p>Might be Model.aliasName, Model.table, or other names given by users</p>
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>refName</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>string</code></span>


            
            </td>

            

            

            <td class="description last">
                <p>The name of the join target</p>
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>opts</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                <p>Extra options such as { select, throughRelation }</p>
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~parseConditions"><span class="type-signature">(inner) </span>parseConditions<span class="signature">(conditions, &hellip;values)</span><span class="type-signature"> &rarr; {Array}</span></h4>

    



<div class="description">
    <p>Allows two types of params:</p>
<pre class="prettyprint source"><code>parseConditions({ foo: { $op: value } })
parseConditions('foo = ?', value)</code></pre>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>conditions</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>string</code></span>
|

<span class="param-type"><code>Object</code></span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>*</code></span>


            
            </td>

            
                <td class="attributes">
                

                

                
                    &lt;repeatable><br>
                
                </td>
            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>














<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>Array</code></span>


    </dd>
</dl>


    
</div>



</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~parseObjectConditions"><span class="type-signature">(inner) </span>parseObjectConditions<span class="signature">(conditions)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>parse conditions in MongoDB style, which is quite polular in ORMs for JavaScript. See <code>module:lib/spell~OPERATOR_MAP</code> for supported <code>$op</code>s.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>conditions</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















<div class="section-examples">
<h5>Example:</h5>

    <pre class="prettyprint"><code>{ foo: null }
{ foo: { $gt: new Date(2012, 4, 15) } }
{ foo: { $between: [1, 10] } }</code></pre>

</div>

</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~parseObjectValue"><span class="type-signature">(inner) </span>parseObjectValue<span class="signature">(value)</span><span class="type-signature"> &rarr; {Object}</span></h4>

    



<div class="description">
    <p>Parse object values as literal or subquery</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>value</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>*</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>














<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>Object</code></span>


    </dd>
</dl>


    
</div>



</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~parseSet"><span class="type-signature">(inner) </span>parseSet<span class="signature">(spell, obj)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Translate key-value pairs of attributes into key-value pairs of columns. Get ready for the SET part when generating SQL.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>spell</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code><a href="Spell.html">Spell</a></code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>obj</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                <p>key-value pairs of attributes</p>
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~Spell_deletedAtIsNull"><span class="type-signature">(inner) </span>Spell_deletedAtIsNull<span class="signature">()</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>If Model supports soft delete, and deletedAt isn't specified in whereConditions yet, and the table isn't a subquery, append a default where({ deletedAt: null }).</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>























</div>

        
            
<div class="section-method">

    

    <h4 class="name" id="~walkExpr"><span class="type-signature">(inner) </span>walkExpr<span class="signature">(ast, fn)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Walk through an ast, starting from the root token.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>ast</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Object</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>fn</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>function</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>

        
    

    

    
</article>

</section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Oct 30 2018 11:03:43 GMT+0800 (CST) using the Minami theme.
</footer>

<script src="scripts/prettify/prettify.js"></script>
<script src="scripts/prettify/lang-css.js"></script>
<!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<script>
prettyPrint();
Array.from(document.querySelectorAll('dl.details'), function(el) {
    if (el.children.length == 0) el.classList.add('empty')
})
</script>
</body>
</html>